sources:
  file_source:
    type: file
    include:
      - "/home/gperreymond/Workspace/github/gperreymond/vector-etl/log/**/*.csv"
  http_source:
    type: http
    host: 0.0.0.0
    port: 9876

transforms:
  remap_file_transform:
    type: script
    inputs:
      - file_source
    source: "
    const [timestamp, tagPath, value] = data.message.split(',');
    data.timestamp = new Date(parseInt(timestamp));
    data.tagPath = tagPath;
    data.value = parseFloat(value);
    delete data.message;
    delete data.file;
    "

sinks:
  rabbitmq_sink:
    type: rabbitmq
    inputs:
      - remap_file_transform
    hostname: localhost
    port: 5672

  console_sink:
    type: console
    inputs:
      - remap_file_transform
      - http_source
